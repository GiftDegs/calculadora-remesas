<!DOCTYPE html>
<html lang="es" class="transition duration-300">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Calculadora de Cambios</title>
  <script>
  // Aplica el tema guardado o el preferido del SO, antes de cargar estilos
  (function () {
    try {
      const saved = localStorage.getItem('theme'); // 'dark' | 'light' | null
      const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
      const shouldDark = saved ? saved === 'dark' : prefersDark;
      if (shouldDark) document.documentElement.classList.add('dark');
      else document.documentElement.classList.remove('dark');
    } catch (_) {
    }
  })();
</script>

  <script src="https://cdn.tailwindcss.com"></script>
    <script>
    tailwind.config = { darkMode: 'class' };
  </script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <script type="module" src="src/main.js" defer></script>


  <style>
    .tasa-shine { position: relative; overflow: hidden; }

    @keyframes pulseEpic { 0%,100%{transform:scale(1);opacity:1}50%{transform:scale(1.05);opacity:0.95} }
    .pulse-epic { animation: pulseEpic 1.5s ease-in-out infinite; }
    .tasa-shine::before {
      content: ""; position: absolute; top: -50%; left: -50%;
      width: 200%; height: 200%;
      background: linear-gradient(120deg, rgba(255,255,255,0) 40%, rgba(255,255,255,0.3) 50%, rgba(255,255,255,0) 60%);
      transform: rotate(25deg); animation: shine 2.5s infinite; pointer-events: none;
    }
    @keyframes shine { from{transform:translateX(-100%) rotate(25deg)} to{transform:translateX(100%) rotate(25deg)} }
    body { font-family: 'Poppins', sans-serif; }

    @keyframes ripple { to { transform: scale(4); opacity: 0; } }
    .ripple-button { position: relative; overflow: hidden; }
    .ripple-button span {
      position: absolute; border-radius: 50%;
      transform: scale(0); background: rgba(255,255,255,0.4);
      animation: ripple 0.6s linear; pointer-events: none;
    }

    .fade-in { animation: fadeIn 0.5s ease-in-out forwards; }
    .fade-scale-in { animation: fadeScale 0.5s ease-out forwards; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes fadeScale { from { opacity: 0; transform: scale(0.95) translateY(10px); } to { opacity: 1; transform: scale(1) translateY(0); } }

    @keyframes fadeSlide {
  from { opacity: 0; transform: translateY(10px) scale(0.98); }
  to   { opacity: 1; transform: translateY(0) scale(1); }
}
.fade-slide-in {
  animation: fadeSlide 0.4s ease-out forwards;
}
@keyframes resultPop {
  0%   { opacity: 0; transform: scale(0.9); }
  80%  { transform: scale(1.02); }
  100% { opacity: 1; transform: scale(1); }
}
.result-pop {
  animation: resultPop 0.6s ease-in-out forwards;
}
/* Entrada / salida suaves para la confirmaci√≥n */
@keyframes confirmIn {
  from { opacity: 0; transform: translateY(-4px) scale(0.98); }
  to   { opacity: 1; transform: translateY(0)    scale(1); }
}
@keyframes confirmOut {
  from { opacity: 1; transform: translateY(0)    scale(1); }
  to   { opacity: 0; transform: translateY(-4px) scale(0.98); }
}
.confirm-in  { animation: confirmIn 0.28s ease-out both; }
.confirm-out { animation: confirmOut 0.24s ease-in forwards; }

/* Parpadeo MUY leve mientras est√° visible */
@keyframes subtleBlink {
  0%, 100% { opacity: 1; }
  50%      { opacity: 0.78; }
}
.confirm-blink { animation: subtleBlink 1.2s ease-in-out infinite; }
@keyframes btloader {
  0%   { transform: translateX(-120%); }
  50%  { transform: translateX(20%); }
  100% { transform: translateX(120%); }
}
.animate-btloader { animation: btloader 1.2s ease-in-out infinite; }

#btnVolverGlobal.fixed-bottom {
  position: fixed;
  bottom: 1.25rem;
  left: 50%;
  transform: translateX(-50%);
  z-index: 40;
  transition: opacity 0.3s ease, transform 0.3s ease;
}

#btnVolverGlobal.hidden {
  opacity: 0;
  pointer-events: none;
}

body.modal-activo {
  overflow: hidden;
}

body.modal-activo *:not(#modalMontoGrande):not(#modalMontoGrande *) {
  pointer-events: none !important;
}


#modalMontoGrande {
  pointer-events: auto;
}

#modalMontoGrande *,
#modalMontoGrande {
  z-index: 9999 !important;
}

@media (max-width: 480px) {
  #btnVolverGlobal {
    font-size: 0.875rem;
    padding: 0.5rem 0.75rem;
  }
}

  </style>
</head>

<body class="transition-colors duration-500 bg-gradient-to-b from-[#EAF6FF] via-pink-50 to-pink-100 text-gray-800 dark:from-gray-900 dark:via-gray-800 dark:to-gray-900 dark:text-gray-100">

  <!-- SPLASH / PRELOADER -->
<div id="splash"
     class="fixed inset-0 z-[100] flex items-center justify-center
            bg-white dark:bg-gray-900 transition-opacity duration-500 opacity-100">
  <div class="flex flex-col items-center gap-4">
    <!-- Logo light/dark -->
    <img src="logo.png" alt="Logo" class="h-16 dark:hidden select-none" />
    <img src="logo.png" alt="Logo" class="h-16 hidden dark:block select-none filter invert-[15%] brightness-110" />
    <!-- Barra de carga animada -->
    <div class="mt-2 h-1.5 w-40 rounded-full bg-gray-200/80 dark:bg-gray-700/70 overflow-hidden">
      <div class="h-full w-2/5 rounded-full bg-[#0066FF] dark:bg-[#66AAFF] animate-btloader"></div>
    </div>
  </div>
</div>

<script>
(function(){
  // =================== CONFIG ===================
  var MIN_VISIBLE_MS  = 2000;      // visibilidad m√≠nima del splash, aunque la app cargue r√°pido
  var MAX_WAIT_MS     = 2500;     // fallback: ocultar aunque no llegue 'load' en este tiempo
  var COOLDOWN_MIN    = 15;      // "memoria": si se mostr√≥ hace < 15 minutos, NO volver a mostrar
  var FADE_MS         = 500;      // debe coincidir con transition-opacity duration-500 del #splash
  var KEY_TS          = 'bt_splash_last_ts'; // localStorage key del √∫ltimo mostrado
  // ==============================================

  // Helper: leer y escribir timestamp
  function now(){ return Date.now(); }
  function getLastTs(){
    try { return Number(localStorage.getItem(KEY_TS) || 0); } catch(_) { return 0; }
  }
  function setLastTs(t){
    try { localStorage.setItem(KEY_TS, String(t)); } catch(_) {}
  }

  var s = document.getElementById('splash');
  if (!s) return;

  // 1) Si el splash se mostr√≥ hace poco, NO lo mostramos
  var last = getLastTs();
  var elapsedMin = (now() - last) / (60*1000);
  if (elapsedMin < COOLDOWN_MIN) {
    s.style.display = 'none';
    return;
  }

  // 2) Mostrar splash (ya est√° visible por defecto en el HTML)
  var shownAt = now();
  var hidden = false;

  function hideSplash(){
    if (hidden) return;
    hidden = true;
    s.style.opacity = '0';
    setTimeout(function(){
      s.style.display = 'none';
    }, FADE_MS);
    setLastTs(now()); // guardamos "se mostr√≥ recientemente"
  }

  // 3) Garantiza una visibilidad m√≠nima (MIN_VISIBLE_MS)
  //    y un fallback si 'load' tarda m√°s de MAX_WAIT_MS
  var maxWait = setTimeout(function(){
    // Si no lleg√≥ 'load' a tiempo, ocultamos igual
    var spent = now() - shownAt;
    var remain = Math.max(0, MIN_VISIBLE_MS - spent);
    setTimeout(hideSplash, remain);
  }, MAX_WAIT_MS);

  window.addEventListener('load', function(){
    clearTimeout(maxWait);
    var spent = now() - shownAt;
    var remain = Math.max(0, MIN_VISIBLE_MS - spent);
    setTimeout(hideSplash, remain);
  });
})();


</script>

<!-- Contenedor ra√≠z responsivo: ocupa el alto √∫til, limita el estiramiento y permite scroll si hace falta -->
  <div id="app"
       class="min-h-[100svh] max-h-[900px] lg:max-h-[840px] mx-auto px-4 py-6
              flex flex-col items-center justify-center overflow-y-auto
              transition-colors duration-500">

    <!-- Contenido central con gap proporcional (no se separa de m√°s en pantallas largas) -->
    <div class="w-full max-w-[720px] flex flex-col items-center
                gap-[clamp(0.5rem,2.2vh,1.25rem)]">

      <div class="absolute top-2 right-2 z-10">
        <button id="toggleDark" class="transition-colors duration-500 bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-100 px-2 sm:px-3 py-1 rounded-md shadow-md text-xs sm:text-sm">üåó Modo</button>
      </div>

      <header id="mainHeader" class="transition-colors duration-500 flex flex-col items-center">
        <img src="logo.png" alt="Logo ByteTransfer" class="h-24 mb-2" />

        <div id="statusHeader"
             class="mt-1 text-base sm:text-lg text-gray-800 dark:text-gray-200 flex items-center gap-2">
          <!-- lo llena JS -->
        </div>

        <!-- T√≠tulo con tama√±o fluido -->
        <h1 class="transition-colors duration-500 font-bold text-center whitespace-nowrap overflow-hidden text-ellipsis max-w-full
                   text-[clamp(1.6rem,4.5vw,2.25rem)] text-[#0066FF] dark:text-[#66AAFF]">
          Calculadora de Cambios
        </h1>

        <p id="subtituloHeader" class="transition-colors duration-500 text-[clamp(0.95rem,2.6vw,1.125rem)] text-[#666666] dark:text-gray-300 text-center -mt-1">
          <!-- Se llenar√° din√°micamente -->
        </p>
      </header>

      <section id="step1Origen" class="flex flex-col items-center gap-4 text-center">
        <p class="text-lg text-gray-700 dark:text-gray-300">¬øDesde d√≥nde quieres enviar?</p>

        <div id="origenBtns" class="flex flex-col gap-3 mt-2">
          <!-- Botones generados por JS -->
        </div>
      </section>

      <section id="step2Destino" class="hidden flex flex-col items-center gap-4 text-center">
        <p class="text-lg text-gray-700 dark:text-gray-300">¬øA qu√© pa√≠s quieres enviar?</p>

        <div id="destinoBtns" class="flex flex-col gap-3 mt-2">
          <!-- Botones generados por JS -->
        </div>
      </section>

      <div id="tasaWrap" class="transition-colors duration-500 flex flex-col items-center transition-all duration-300">
        <p id="tasaTitulo" class="text-base font-semibold text-gray-700 dark:text-gray-300">Tasa del d√≠a</p>
        <p id="tasaFecha" class="text-sm italic text-[#666666] dark:text-gray-400">‚Äî</p>

        <div id="tasaCard" class="tasa-shine mt-2 min-w-[10rem] px-6 py-6 flex items-center justify-center rounded-2xl bg-[#E1F0FF]/80 dark:bg-white/10 backdrop-blur-md ring-1 ring-black/5 shadow-[0_8px_20px_rgba(0,0,0,0.12)] transition-all duration-300 relative">
          <span id="tasaValue" class="text-6xl font-extrabold text-blue-900 dark:text-blue-300 tracking-tight drop-shadow-lg select-none transition-all duration-300 pulse-epic">‚Äì</span>
        </div>

        <!-- Advertencia roja -->
        <div id="tasaAdvertencia"
            class="hidden mt-3 w-full max-w-md text-red-800 bg-red-50 border border-red-200 rounded-xl px-4 py-3 shadow-sm text-sm font-semibold flex items-start gap-2 justify-center ring-1 ring-red-300"
            role="status" aria-live="polite">
          <span id="tasaAdvertenciaTexto">üö® Tasa desactualizada üö®</span>
        </div>

        <!-- Confirmaci√≥n verde -->
        <div id="tasaConfirmacion"
            class="hidden mt-3 w-full max-w-md text-green-800 bg-green-50 border border-green-200 rounded-xl px-4 py-3 shadow-sm text-sm font-semibold flex items-start gap-2 justify-center"
            role="status" aria-live="polite">
          <span id="tasaConfirmacionTexto">Tasa actualizada</span>
        </div>
      </div>

      <section id="step1" class="transition-colors duration-500 flex flex-col items-center gap-2 text-center">
        <p class="text-sm text-gray-600 dark:text-gray-300 italic">
          Tasa sujeta a cambios sin previo aviso.
        </p>
        <h2 class="text-[clamp(1.15rem,3.5vw,1.35rem)] font-semibold">Elige una opci√≥n</h2>
        <button id="btnEnviar" class="ripple-button border rounded-xl px-6 py-3 font-semibold shadow transition hover:scale-105
       bg-white/80 text-[#0066FF] border-[#0066FF]/50
       dark:bg-white/10 dark:text-[#9cc2ff] dark:border-[#66a3ff]/40
       backdrop-blur-sm dark:hover:bg-white/15">¬øCu√°ntos pesos quieres enviar?</button>
        <button id="btnLlegar"class="ripple-button border rounded-xl px-6 py-3 font-semibold shadow transition hover:scale-105
       bg-white/80 text-[#0066FF] border-[#0066FF]/50
       dark:bg-white/10 dark:text-[#9cc2ff] dark:border-[#66a3ff]/40
       backdrop-blur-sm dark:hover:bg-white/15">¬øCu√°nto bol√≠vares quieres que lleguen?</button>
      </section>


      <section id="step2" class="transition-colors duration-500 hidden flex flex-col items-center gap-4">
        <p id="preguntaMonto" class="text-lg font-semibold text-gray-800 dark:text-white opacity-0 translate-y-4 transition-all duration-300"></p>
        <p id="errorMonto" class="text-[#FF0000] font-semibold hidden transition-all duration-300"></p>
        <p id="ayudaMonto" 
   class="text-xs sm:text-sm text-gray-600 dark:text-gray-400 text-center leading-snug space-y-0.5">
  <span class="block">Min: <strong>28,7 BRL</strong> ‚Ä¢ Max: <strong>5740 BRL</strong></span>
  <span class="block">‚ö† Modo referencia ‚Äî tasa no vigente</span>
  <span class="block">üïí Hoy: 11:00‚Äì23:00</span>
</p>


        <input id="inputMonto" type="text" inputmode="decimal" placeholder="Ingresa el monto"
          class="w-72 text-center text-2xl font-semibold px-6 py-4 rounded-xl border
       border-blue-300 shadow bg-white/70 text-gray-800 placeholder-gray-400
       dark:bg-white/10 dark:text-white dark:placeholder-gray-400
       dark:border-blue-300/40 backdrop-blur-md
       focus:outline-none focus:ring-2 focus:ring-blue-300 transition">

        <div class="flex gap-4">
          <button id="btnCalcular" class="bg-gradient-to-r from-[#0066FF] to-purple-600 text-white px-6 py-2 rounded-xl shadow hover:scale-105 transition-all">Calcular</button>
        </div>
      </section>

     <div class="w-full -mt-1 mb-2 items-center">
  <button id="btnVolverGlobal"
          class="hidden inline-flex items-center gap-2 px-4 py-2 rounded-xl border
                 border-gray-300/70 dark:border-gray-600/60
                 bg-white/60 dark:bg-gray-700/50
                 text-gray-800 dark:text-white
                 backdrop-blur-sm shadow-sm"
          type="button">‚Üê Volver</button>
</div>



      <section id="calculando"
        class="hidden fixed inset-0 z-50 flex items-center justify-center bg-white/80 dark:bg-black/70 backdrop-blur-md animate-pulse text-2xl font-semibold text-gray-800 dark:text-gray-100">
        ‚è≥ Calculando...
      </section>

      <section id="resultado" class="transition-colors duration-500 hidden flex flex-col items-center gap-6">
        <div id="resTextContainer" class="transition-colors duration-500 relative bg-white text-gray-800 dark:bg-gray-900 dark:text-gray-100 
          rounded-xl px-6 py-8 shadow-xl ring-1 ring-gray-300 dark:ring-gray-700 hover:shadow-2xl transition-all duration-500 ease-in-out flex flex-col items-center gap-4 w-full max-w-md">

          <button id="btnCompartir" title="Compartir"
            class="absolute top-2 right-2 w-10 h-10 transition transform hover:scale-110 z-10">
            <img src="share.png" alt="Compartir" class="w-full h-full object-contain drop-shadow-md" />
          </button>

          <div id="menuCompartir" class="absolute top-12 right-2 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-lg z-20 hidden">
            <button id="opcionImagen" class="block w-full text-left px-4 py-2 text-sm text-gray-800 dark:text-gray-100 hover:bg-gray-100 dark:hover:bg-gray-700">üì∑ Compartir imagen</button>
            <button id="opcionTexto"  class="block w-full text-left px-4 py-2 text-sm text-gray-800 dark:text-gray-100 hover:bg-gray-100 dark:hover:bg-gray-700">üí¨ Compartir texto</button>
          </div>

          <img src="logo.png" alt="Logo ByteTransfer" class="h-12">
          <div id="resText" class="text-center text-xl sm:text-2xl font-semibold leading-relaxed"></div>
          <p class="text-sm text-gray-400 italic mt-4">Powered by ByteTransfer</p>
        </div>

        <div class="flex flex-col gap-3">
          <button id="btnRecalcular" class="bg-gray-200 dark:bg-gray-600 text-gray-800 dark:text-white px-5 py-2 rounded-lg shadow">üîÅ Calcular otro</button>
          <button id="btnWhats" class="bg-[#25D366] text-white px-6 py-3 rounded-lg shadow hover:bg-green-700">Ir a WhatsApp</button>
        </div>
      </section>

    <audio id="soundSuccess"
           src="https://cdn.pixabay.com/download/audio/2022/10/03/audio_a69f47a883.mp3"
           preload="auto"></audio>
  </div>
  <div id="toastMensaje" class="fixed top-[170px] right-[30px] bg-white dark:bg-gray-900 text-gray-800 dark:text-gray-100 border border-gray-200 dark:border-gray-700 shadow-xl rounded-xl px-5 py-4 text-sm sm:text-base font-medium hidden transition-all duration-500 z-50 whitespace-pre-line text-left max-w-xs w-[250px] leading-relaxed pointer-events-none opacity-0 scale-95">
</div>

<!-- MODAL: Advertencia por montos grandes -->
<div id="modalMontoGrande" class="fixed inset-0 bg-black bg-opacity-60 backdrop-blur-sm flex items-center justify-center z-50 hidden">
  <div class="bg-white dark:bg-gray-800 text-gray-800 dark:text-gray-100 rounded-xl shadow-xl p-6 w-[90%] max-w-md text-center space-y-4">
    <p class="text-lg font-semibold">‚ÑπÔ∏è Montos mayores a 300 USD se env√≠an en varias partes.</p>
    <button id="btnCerrarModalMonto" class="mt-4 px-5 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition">Aceptar</button>
  </div>
</div>
</div>

</body>
</html>